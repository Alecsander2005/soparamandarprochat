<div class="{{ css_class }}">
    <label for="selected-{{ field_name }}">{{ modal_title }}</label>
    <div class="input-group">
        <input type="hidden" name="{{ field_name }}" id="{{ field_name }}_id">
        <input type="text" id="selected-{{ field_name }}" class="form-control" readonly placeholder="Clique no botão para selecionar {{ modal_title }}">
        <div class="input-group-append">
            <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#{{ modal_id }}-{{ prefix }}">
                Selecionar
            </button>
        </div>
    </div>
</div>

<!-- Modal para seleção de utilizador -->
<div class="modal fade" id="{{ modal_id }}-{{ prefix }}" tabindex="-1" role="dialog" aria-labelledby="{{ modal_id }}-{{ prefix }}Label" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="{{ modal_id }}-{{ prefix }}Label">{{ modal_title }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="search" class="form-control" id="{{ field_name }}-{{ prefix }}-search" name="search" placeholder="Buscar por CPF, nome ou email"
                    hx-get="{% url search_url %}"
                    hx-trigger="keyup changed delay:500ms"
                    hx-target="#{{ modal_id }}-{{ prefix }}-results"
                    hx-indicator="#{{ modal_id }}-{{ prefix }}-loading">
                <div id="{{ modal_id }}-{{ prefix }}-results"></div>
                <div id="{{ modal_id }}-{{ prefix }}-loading" style="display: none;">Carregando...</div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Função para configurar os handlers de clique para cada cartão de Enjoyer
        function setupEnjoyerClickHandlers() {
            document.querySelectorAll('.enjoyer-card').forEach(element => {
                element.addEventListener('click', function() {
                    const enjoyerId = this.getAttribute('data-id');
                    const enjoyerName = this.getAttribute('data-name'); 

                    // Atualiza o campo oculto com o ID do Enjoyer
                    document.getElementById('{{ field_name }}_id').value = enjoyerId;

                    // Atualiza o campo de texto com o nome do Enjoyer
                    document.getElementById('selected-{{ field_name }}').placeholder = enjoyerName;

                    // Fecha o modal após a seleção
                    $('#{{ modal_id }}-{{ prefix }}').modal('hide');
                });
            });
        }

        // Função para aplicar efeitos de hover sobre os cartões de Enjoyer
        function setupEnjoyerHoverEffects() {
            document.querySelectorAll('.hover-effect-enjoyer').forEach(element => {
                element.addEventListener('mouseenter', () => element.style.backgroundColor = '#f8f9fa'); // Cor mais clara para hover
                element.addEventListener('mouseleave', () => element.style.backgroundColor = ''); // Reset para cor padrão
            });
        }

        // Reaplica os handlers e efeitos após cada atualização de conteúdo via HTMX
        document.body.addEventListener('htmx:afterSwap', () => {
            setupEnjoyerHoverEffects();
            setupEnjoyerClickHandlers();
        });

        // Inicializa os handlers e efeitos na primeira carga da página
        setupEnjoyerHoverEffects();
        setupEnjoyerClickHandlers();
    });
</script>
